{% extends '__base__.html' %}

{% block title %}编辑日志{% endblock %}

{% block beforehead %}
<script type="text/javascript">
    var 
        ID = '{{ id }}' ,
        action = '{{ action }}';
    function initVM(blog) {
        var vm = new Vue({
            el:'#vm',
            data:blog,
            methods:{
                submit:function(event){
                    event.preventDefault();
                    var $form = $('#vm');
                    if (! this.name.trim()) {
                        return $form.showFormError('请输入题目');
                    }
                    if (! this.content.trim()) {
                        return $form.showFormError('请输入内容');
                    }
                    $form.postJSON(action,this.$data,function(err,r){
                        if (!err) {
                            return location.assign('/manage/blogs');
                        }
                    })
                }
            }
        })
    }
    $(function(){
        if (ID) {
            getJSON('/api/blogs/'+ID,function(err,blog){
                if (err) {
                    var $form = $('#vm');
                    return $form.showFormError(err);
                }
                initVM(blog);
            });
        }
        else {
            initVM({
                name:'',
                summary:'',
                content:''
            });
        }
    })
    $(function(){
        var $topbarlistl = $('.topbarlist_fl li:first-child');
        var $topbarlistr = $('.topbarlist_fl li:last-child');
        $topbarlistl.removeClass('active');
        $topbarlistr.addClass('active');
    })
</script>
{% endblock %}

{% block content %}

<div class="edit_blog">
    <form id="vm">
        <div class="Formerror"></div>
        <div>
            <label for="blogName"><h1>{ { 标题 } }</h1></label>
            <input type="text" name="blogName" id="blogName" placeholder="文章标题" v-model='name'></div>
        <div>                
            <label for="blogSummary"><h1>{ { 摘要 } }</h1></label>
            <textarea id="blogSummary" placeholder="文章摘要" rows="5" v-model='summary'></textarea>
        </div>
        <div>                
            <label for="blogcontent"><h1>{ { 内容 } }</h1></label>
            <textarea id="blogcontent" placeholder="文章内容"  rows="20" v-model='content'></textarea>
        </div>
        <button type="submit" v-on:click='submit'>保存</button>
        <a href="#">取消</a>
    </form>
</div>

{% endblock %}