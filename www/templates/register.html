{% extends '__base__.html' %}

{% block title %}注册{% endblock %}

{% block beforehead %}
    <script type="text/javascript">
        //检测email
        function validateEmail(email){
            var re = /^(\w)+(\.\w)*\@(\w)+((\.\w{2,3}){1,3})$/;
            return re.test(email);
        }
        $(function(){
            var vm = new Vue({
                el:'#vm',
                data:{
                    name:'',
                    email:'',
                    passwd1:'',
                    passwd2:''
                },
                methods:{
                    submit:function(event){
                        event.preventDefault();
                        var email = this.email.trim().toLowerCase();
                        var $form = $('#vm');
                        if (! this.name.trim()) {
                            return $form.showFormError('请输入名字');
                        }
                        if (! validateEmail(email)) {
                            return $form.showFormError('请输入正确邮箱地址');
                        }
                        if (this.passwd1.length < 6) {
                            return $form.showFormError('密码口令至少为六位');
                        }
                        if (this.passwd1 !== this.passwd2) {
                            return $form.showFormError('两次密码不一致');
                        }
                        $form.postJSON('/api/users',{
                            name:this.name.trim(),
                            email:email,
                            passwd:CryptoJS.SHA1(email + ':' + this.passwd1).toString()
                        },function(err,r){
                            if (!err) {
                                return location.assign('/');
                            }
                        })
                    }
                }
            })
        })
        $(function(){
            $('.topbarlist_sign li:last-child').addClass('active');
        })
    </script>
{% endblock %}

{% block content %}
    <div class="content-container">        
        <div class="rosForm">
            <div class="rosFormtitle">
                <h1>----  欢迎注册  ----</h1>
            </div>
            <form id="vm">
                <div class="Formerror"></div>
                <div>
                    <label for="rosName">名字：</label><input v-model="name" type="text" name="rosName" id="rosName" placeholder="请填写注册名">
                </div>
                <div>
                    <label for="rosEmail">电子邮箱：</label><input v-model="email" type="text" name="rosEmail" id="rosEmail" placeholder="请输入你的个人邮箱">
                </div>
                <div>
                    <label for="ros_pw">输入密码：</label><input v-model="passwd1" type="password" name="ros_pw" id="ros_pw" placeholder="请设定你的密码口令（至少6位）">
                </div>
                <div>
                    <label for="register_pw2">重复输入密码：</label><input v-model="passwd2" type="password" name="register_pw2" id="register_pw2" placeholder="请重复你的密码口令">
                </div>
                <div class="rosFormbottom">
                    <button type="submit" v-on:click='submit'>注册</button>
                </div>
            </form>
        </div>
    </div>
{% endblock %}